---
nsd_install: true
nsd_directory: /etc/nsd

nsd_server_interfaces:
  - "{{ ipv4 }}"
  - "{{ ipv6 }}"

nsd_server_pid_file: "/etc/nsd/run/nsd.pid"
nsd_server_xfrd_file: "/etc/nsd/db/xfrd.state"
nsd_server_xfr_dir: "/etc/nsd/tmp"
nsd_server_zones_dir: "/etc/nsd/zones"
nsd_server_dnssec_key_dir: "/etc/nsd/keys"
nsd_server_zonelist_file: "/etc/nsd/db/zone.list"
nsd_server_refuse_any: "yes"
nsd_server_chroot: "{{ nsd_directory }}"
nsd_server_remote_control_enable: "yes"
nsd_server_remote_control_interfaces:
  - "127.0.0.1"
  - "::1"

# pass these variables. see README
nsd_zones: []

nsd_zone_attributes: {}

nsd_default_ttl: 300
nsd_default_dns_refresh: 300
nsd_default_dns_retry: 300
nsd_default_dns_expire: 300
nsd_default_dns_negative_response_cache: 300
nsd_default_dnssec_algo: ECDSAP384SHA384
nsd_default_make_ascii: false
nsd_default_dkim_enabled: false
nsd_default_dkim_domain: ""
nsd_default_dkim_keys: []
nsd_default_dnssec_enabled: false
nsd_default_zsk_rollover: "7"
nsd_default_zsk_grace_period: "1"
nsd_default_dnssec_propagation_delay: "24"
nsd_default_reverse_zone_v4_enabled: false
nsd_default_reverse_zone_v6_enabled: false
nsd_default_reverse_zone_v4_name: ""
nsd_default_reverse_zone_v6_name: ""

# magic to generate DNS serial (bliss)
_today: "{{ lookup('pipe','gdate +%Y%m%d') }}"
_epoch_midnight: "{{ lookup('pipe','gdate --date={{ _today }} +%s') }}"
_time_now: "{{ lookup('pipe','gdate +%s') }}"
_num_secs: "{{ _time_now  | int - _epoch_midnight | int }}"
_day_incr: "{{ (_num_secs | int * 99 / 86400)    | int }}"
_dns_serial: "{{ _today }}{{ _day_incr }}"
